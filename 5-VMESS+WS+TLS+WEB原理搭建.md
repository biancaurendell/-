## 科普

vmess 协议 (http协议)

v2ray 网络工具 （谷歌浏览器）dns和路由

clash 网络工具 （火狐浏览器）

---

vmess是一个比trojan出现更早、使用更广泛的协议 作为使用者，我们的重点是如何使用他，但是不讲vmess协议的通信流程又无法对一些特性有深刻的认识，比如vmess节点为什么当电脑系统时间不对的时候无法链接？又比如为什么加密方式可以使用自动选择，按照之前讲ss节点说的，对称加密算法必须让两边都存在相同的密钥和加密方式才能正常解密。再比如额外ID到底是个啥？还有承载vmess数据的传输协议与伪装的区别，本节的话就来带大家了解上述问题，并由浅入深实操搭建一个实现web伪装的vmess节点。

# vmess通信过程

原理图：

![image-20230930100920989](E:\610 - 编程开发\622-课程笔记\A01-计算机网络\自建节点\5-VMESS+WS+TLS+WEB原理搭建.assets\image-20230930100920989.png)

![image-20230930100950477](E:\610 - 编程开发\622-课程笔记\A01-计算机网络\自建节点\5-VMESS+WS+TLS+WEB原理搭建.assets\image-20230930100950477.png)

v2ray作为网络工具，监听你所发出的数据流量

## 时间戳

时间戳（Timestamp）是一个表示日期和时间的数值或字符串，通常以特定的格式表示，以便计算机系统能够识别和处理日期和时间信息。时间戳通常用于记录事件的发生时间、数据的创建或修改时间以及其他需要时间参考的情境中。

1. **Unix 时间戳**：Unix 时间戳是指自 1970 年 1 月 1 日 00:00:00（协调世界时，UTC）以来经过的秒数。它通常表示为一个整数。Unix 时间戳是计算机领域中最常用的时间戳格式，因为它易于处理和比较。
2. **日期时间字符串**：时间戳也可以表示为日期和时间的字符串，如 "2023-09-24 14:30:00"。这种格式更容易人类阅读，但在计算机处理时通常需要将其转换为内部表示。
3. **Epoch 时间戳**：Epoch 时间戳是指自定义的起始时间点以来经过的时间。不同的系统和编程语言可以选择不同的 Epoch 时间。例如，JavaScript 使用的 Epoch 时间是 1970 年 1 月 1 日 00:00:00 UTC。

时间戳在计算机编程、日志记录、数据存储和处理等各种领域都有广泛应用。它们用于确定事件的顺序、计算时间间隔、生成时间图表、数据分析等任务。很多编程语言和操作系统都提供了处理时间戳的库和工具函数，以简化时间操作。

请注意，时间戳的精度可以因不同的实现而异。有的时间戳表示到秒，有的表示到毫秒、微秒甚至纳秒。选择合适的时间戳精度取决于具体的应用需求。

---

国内服务器作用：

通过在数据包头部插入经过哈希运算的时间戳

再在数据包的头部插入目标Ip地址





国外服务器作用：

先对相应的vps进行vmess协议配置，配置好这样一台vps即可

首先，将绕过GFW的协议包的Ip地址去除，这串数据交给v2ray来处理，v2ray设置入站协议vmess协议

验证是否是一个合法的vmess数据

如何验证

对比头部的这一串数据到底是不是而合法的（哈希值的算法是不可逆的）,验证算法是取范围然后全部取值然后进行哈希算法，最后实现验证功能 

验证成功

解密第二层数据（以用户Id以一种特定的方式加密的数据）

解密第一层数据（用第二层解密得出的数据来进行解密）、

得到内容，发送给服务器‘



---

额外Id作用

同时发送是，容易出现哈希值一致，额外id的作用 

---

可惜的是vmess协议已经被淘汰了，因为 md5认证方式已经被v2ray强制停用了



![image-20230930103115369](E:\610 - 编程开发\622-课程笔记\A01-计算机网络\自建节点\5-VMESS+WS+TLS+WEB原理搭建.assets\image-20230930103115369.png)

# 实际搭建流程

* 注册vps
* 在vps中搭建v2ray
  * 
  * github.com/v2fly/fhs-install-v2ray 使用一键脚本搭建![image-20230930103945361](E:\610 - 编程开发\622-课程笔记\A01-计算机网络\自建节点\5-VMESS+WS+TLS+WEB原理搭建.assets\image-20230930103945361.png)

![image-20230930104152733](E:\610 - 编程开发\622-课程笔记\A01-计算机网络\自建节点\5-VMESS+WS+TLS+WEB原理搭建.assets\image-20230930104152733.png)

在v2ray本地客户端配置

![image-20230930104303435](E:\610 - 编程开发\622-课程笔记\A01-计算机网络\自建节点\5-VMESS+WS+TLS+WEB原理搭建.assets\image-20230930104303435.png)f

记得关闭vps中的防火墙否则会导致“**操作超时**”

传输的数据都是无规则的字节流，这样会引起防火墙的注意，所以需要进行引入tls进行数据加密，从而在表面上看起来和普通https数据一致

![image-20230930104637869](E:\610 - 编程开发\622-课程笔记\A01-计算机网络\自建节点\5-VMESS+WS+TLS+WEB原理搭建.assets\image-20230930104637869.png)

都加入传输安全：tls

ip地址改为域名地址意味着，tls中需要申请证书，这个证书可以自己申请也可以想CA机构进行申请

加密方式为何改成zero: 因为最后tls协议会进行加密，这样会导致双重加密

vmess+ws+tcp 

什么是ws： ![image-20230930183525148](E:\610 - 编程开发\622-课程笔记\A01-计算机网络\自建节点\5-VMESS+WS+TLS+WEB原理搭建.assets\image-20230930183525148.png)

ws其实就是tcp，但是加了更多的伪装   

目前最稳定的科学方式就是vmess+ws+tls+web的这种组合方式

web的作用是用来重定向，似乎这也是镜像站的制作方式

tls是对整个数据包进行加密操作

ws作用是

vmess就是这个组合的核心

